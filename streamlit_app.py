# -*- coding: utf-8 -*-
import streamlit as st
import pandas as pd
import plotly.express as px

# =========================
# 1) ã‚³ãƒ³ãƒ•ã‚£ã‚°è¨­å®š
# =========================
CONFIG = {
    "app_title": "ä¸­å­¦å—é¨“ï¼šã‚ãŒå®¶ã®ã€Œè„³å†…ç’°å¢ƒã€3åˆ†è¨ºæ–­",
    "app_subtitle": (
        "SCARFãƒ¢ãƒ‡ãƒ«ã«åŸºã¥ãã€ãŠå­ã•ã‚“ã®çŸ¥èƒ½ã‚’æœ€å¤§åŒ–ã™ã‚‹"
        "å®¶åº­ç’°å¢ƒã‚’å¯è¦–åŒ–ã—ã¾ã™ã€‚"
    ),
    "intro_notes": [
        "ãƒ»ã“ã®è¨ºæ–­ã¯ã€ä¸­å­¦å—é¨“ã«å‘ã‘ãŸã€è¦ªå­ã®è„³å†…ç’°å¢ƒã€ã‚’æ•´ãˆã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚",
        "ãƒ»åå·®å€¤ã§ã¯ãªãã€ãŠå­ã•ã‚“ã®ã€è„³ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€ã‚’å¼•ãå‡ºã™åœŸå£Œã‚’ç¢ºèªã—ã¾ã™ã€‚",
        "ãƒ»å›ç­”æ™‚é–“ã¯ç´„3åˆ†ã€‚ç›´æ„Ÿã§ãŠç­”ãˆãã ã•ã„ã€‚",
    ],
    "footer": "Â© æ•™è‚²è„³ç§‘å­¦note / SCARF Diagnosis Tool",
}

# =========================
# [cite_start]2) è¨­å•å®šç¾©ï¼ˆ15å•ï¼šSCARFå„3å•ï¼‰ [cite: 3, 5, 10, 17]
# =========================
CATEGORIES = {
    "S": "Statusï¼ˆåœ°ä½ãƒ»è‡ªå·±è‚¯å®šæ„Ÿï¼‰",
    "C": "Certaintyï¼ˆç¢ºå®Ÿæ€§ãƒ»è¦‹é€šã—ï¼‰",
    "A": "Autonomyï¼ˆè‡ªå¾‹æ€§ãƒ»è‡ªå·±æ±ºå®šï¼‰",
    "R": "Relatednessï¼ˆé–¢ä¿‚æ€§ãƒ»ä¿¡é ¼ï¼‰",
    "F": "Fairnessï¼ˆå…¬å¹³æ€§ãƒ»ç´å¾—æ„Ÿï¼‰"
}

QUESTIONS = [
    # [cite_start]Status [cite: 12, 23]
    {"cat": "S", "title": "å­ä¾›ãŒè§£ãæ–¹ã‚’èª¬æ˜ã—ã¦ãã‚Œã‚‹ã¨ãã€ã€æ•™å®˜ã€ã¨ã—ã¦æ•¬æ„ã‚’æŒã£ã¦è´ã„ã¦ã„ã‚‹ã€‚"},
    {"cat": "S", "title": "ä»–äººã®æˆç¸¾ã¨ã®ã€æ¨ªã®æ¯”è¼ƒã€ã§ã¯ãªãã€éå»ã®æœ¬äººã®æˆé•·ï¼ˆç¸¦ã®æ¯”è¼ƒï¼‰ã§å£°ã‚’ã‹ã‘ã¦ã„ã‚‹ã€‚"},
    {"cat": "S", "title": "ãƒ†ã‚¹ãƒˆã®çµæœãŒæ‚ªãã¦ã‚‚ã€äººæ ¼ã‚’å¦å®šã›ãšã€æˆ¦ç•¥ã®æ”¹å–„ãƒ‡ãƒ¼ã‚¿ã€ã¨ã—ã¦æ‰±ãˆã¦ã„ã‚‹ã€‚"},
    # [cite_start]Certainty [cite: 14, 25]
    {"cat": "C", "title": "1é€±é–“ã®å­¦ç¿’äºˆå®šãŒãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰ãªã©ã§ã€è¦‹ãˆã‚‹åŒ–ã€ã•ã‚Œã¦ãŠã‚Šã€è¦ªå­ã§å…±æœ‰ã§ãã¦ã„ã‚‹ã€‚"},
    {"cat": "C", "title": "ã€ã—ã£ã‹ã‚Šã‚„ã‚Šãªã•ã„ã€ã§ã¯ãªãã€ã€ã“ã®ãƒšãƒ¼ã‚¸ãŒçµ‚ã‚ã‚Œã°å®Œäº†ã€ã¨ã‚´ãƒ¼ãƒ«ãŒæ˜ç¢ºã§ã‚ã‚‹ã€‚"},
    {"cat": "C", "title": "æˆç¸¾ã‚„äºˆå®šã®å¤‰æ›´ãªã©ã€æ‚ªã„ãƒ‹ãƒ¥ãƒ¼ã‚¹ã»ã©æ„Ÿæƒ…ã‚’å…¥ã‚Œãšæ—©ã‚ã«å…±æœ‰ã—ã¦ã„ã‚‹ã€‚"},
    # [cite_start]Autonomy [cite: 8, 9]
    {"cat": "A", "title": "ã€ä½•ã‹ã‚‰å‹‰å¼·ã‚’å§‹ã‚ã‚‹ã‹ã€ã‚’ã€å­ä¾›è‡ªèº«ãŒé¸ã¹ã‚‹ä½™åœ°ãŒã‚ã‚‹ã€‚"},
    {"cat": "A", "title": "è¦ªã®æŒ‡ç¤ºå¾…ã¡ã§ã¯ãªãã€å­ä¾›ãŒè‡ªåˆ†ã®åˆ¤æ–­ã§å‹•ã‘ã‚‹ã€ç©ºç™½ã®æ™‚é–“ã€ãŒã‚ã‚‹ã€‚"},
    {"cat": "A", "title": "å‹‰å¼·å ´æ‰€ã‚„ä¼‘æ†©ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãªã©ã€å°ã•ãªæ±ºå®šæ¨©ã‚’å­ä¾›ã«è­²ã£ã¦ã„ã‚‹ã€‚"},
    # Relatedness
    {"cat": "R", "title": "1æ—¥ã®ã†ã¡ã«ã€å‹‰å¼·ä»¥å¤–ã®ã€ãŸã‚ã„ã‚‚ãªã„é›‘è«‡ã€ã§ç¬‘ã„åˆã†æ™‚é–“ãŒã‚ã‚‹ã€‚"},
    {"cat": "R", "title": "å­ä¾›ãŒã€å›°ã£ãŸã€ã¨è¨€ã„ã‚„ã™ã„ã€å¿ƒç†çš„ãªå®‰å…¨åŸºåœ°ãŒå®¶åº­ã«ã‚ã‚‹ã€‚"},
    {"cat": "R", "title": "è¦ªè‡ªèº«ã®ã€æ©Ÿå«Œã€ã«å·¦å³ã•ã‚Œãšã€å­ä¾›ã¨å®‰å®šã—ãŸã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå–ã‚Œã¦ã„ã‚‹ã€‚"},
    # Fairness
    {"cat": "F", "title": "ã€é ‘å¼µã£ãŸã‚‰ã”è¤’ç¾ã€ãªã©ã®ãƒ«ãƒ¼ãƒ«ãŒæ˜ç¢ºã§ã€è¦ªå­ã§ç´å¾—ã—ã¦é‹ç”¨ã•ã‚Œã¦ã„ã‚‹ã€‚"},
    {"cat": "F", "title": "æˆåŠŸã—ãŸã¨ãã ã‘ã§ãªãã€åŠªåŠ›ã®ãƒ—ãƒ­ã‚»ã‚¹ã«å¯¾ã—ã¦æ­£å½“ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ã—ã¦ã„ã‚‹ã€‚"},
    {"cat": "F", "title": "å®¶æ—ã®ä¸­ã§èª°ã‹ã ã‘ãŒæˆ‘æ…¢ã™ã‚‹ã®ã§ã¯ãªãã€å…¨å“¡ãŒç´å¾—æ„Ÿã‚’æŒã£ã¦éã”ã›ã¦ã„ã‚‹ã€‚"},
]

# =========================
# 3) é­‚ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ–‡ï¼ˆ15ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
# =========================
FEEDBACK = {
    "S": {
        "high": """ã€æœ€é«˜ã®å…±å‰µãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã€‘ ãŠå­ã•ã‚“ã‚’ä¸€äººã®ã€ŒçŸ¥çš„ãªäººé–“ã€ã¨ã—ã¦æ·±ãå°Šé‡ã§ãã¦ã„ã¾ã™ã€‚
                ã‚ãªãŸãŒã€Œæ•™å®˜ã€å½¹ã‚’è­²ã‚Šã€ãŠå­ã•ã‚“ã®æˆ¦ç•¥ã«é©šãã€å…±ã«å–œã¶å§¿å‹¢ã¯ã€è„³ã«ã¨ã£ã¦æœ€å¤§ã®å ±é…¬ã¨ãªã‚Šã¾ã™ã€‚
                åå·®å€¤ã¨ã„ã†æ•°å­—ã‚’è¶…ãˆãŸã€ä¸€ç”Ÿãƒ¢ãƒã®è‡ªä¿¡ãŒè‚²ã£ã¦ã„ã¾ã™ã€‚""",
        "mid": """ã€å¿œæ´å›£ã¾ã§ã‚ã¨ä¸€æ­©ã€‘ ã¤ã„ã¤ã„ã€Œæ•™ãˆã¦ã‚ã’ãªãã‚ƒã€ã¨å…ˆå›ã‚Šã—ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ 
                ãã®å„ªã—ã•ãŒã€æ™‚ã«ãŠå­ã•ã‚“ã®ã€Œè‡ªåˆ†ã§ã§ããŸï¼ã€ã¨ã„ã†åœ°ä½ï¼ˆStatusï¼‰ã‚’å¥ªã£ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
                æ™‚ã«ã¯ã€Œã¸ã‡ã€ãã‚“ãªè§£ãæ–¹ãŒã‚ã‚‹ã‚“ã ï¼ã€ã¨ã€ã‚ãˆã¦æ•™ãˆã‚’è«‹ã†ã¦ã¿ã¦ãã ã•ã„ã€‚""",
        "low": """ã€ç·Šæ€¥å‡¦æ–¹ç®‹ã€‘ ä»Šã€ãŠå­ã•ã‚“ã®è„³ã¯ã€Œè‡ªåˆ†ã¯ãƒ€ãƒ¡ã ã€ã¨ã„ã†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¸ã®è„…å¨ã«ã•ã‚‰ã•ã‚Œã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
                ç‚¹æ•°ã§åˆ¤æ–­ã™ã‚‹ã®ã‚’ä¸€åº¦ã‚„ã‚ã€å½¼ã‚‰ãŒå¿…æ­»ã«è€ƒãˆãŸã€Œãƒ—ãƒ­ã‚»ã‚¹ã€ã‚’ãƒ—ãƒ­ã®ä»•äº‹ã¨ã—ã¦ç§°ãˆã¦ãã ã•ã„ã€‚
                è‡ªä¿¡ã®å›å¾©ã“ããŒã€é€†è»¢åˆæ ¼ã¸ã®å”¯ä¸€ã®é“ã§ã™ã€‚"""
    },
    "C": {
        "high": """ã€å®‰å¿ƒåŸºåœ°ã®å¸ä»¤å¡”ã€‘ å®¶åº­å†…ã«æ˜ç¢ºãªã€Œåœ°å›³ã€ãŒå­˜åœ¨ã—ã¦ã„ã¾ã™ã€‚
                æ¬¡ã«ä½•ã‚’ã™ã¹ãã‹ãŒè¦‹ãˆã¦ã„ã‚‹ãŸã‚ã€ãŠå­ã•ã‚“ã®è„³ã¯ç„¡é§„ãªã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’ä½¿ã‚ãšã€å­¦ç¿’ã«ãƒ•ãƒ«ã‚³ãƒŸãƒƒãƒˆã§ãã¦ã„ã¾ã™ã€‚
                æ—¥æ›œå¤œã®ç©ã‚„ã‹ãªç©ºæ°—ã“ããŒã€ã‚ãªãŸã®åŠªåŠ›ã®çµæ™¶ã§ã™ã€‚""",
        "mid": """ã€éœ§ã®ä¸­ã®èˆªæµ·å£«ã€‘ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã‚ã‚‹ã‚‚ã®ã®ã€ã‚´ãƒ¼ãƒ«ãŒå°‘ã—æ›–æ˜§ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
                ã€Œã—ã£ã‹ã‚Šã‚„ã‚‹ã€ã¨ã„ã†è¨€è‘‰ã‚’æ¨ã¦ã€ã€Œã“ã®3å•ãŒçµ‚ã‚ã£ãŸã‚‰è‡ªç”±æ™‚é–“ã€ã¨1ãƒŸãƒªå˜ä½ã§ã‚´ãƒ¼ãƒ«ã‚’æ˜ç¢ºã«ã—ã¾ã—ã‚‡ã†ã€‚
                è„³ã«ã€Œçµ‚ã‚ã‚Šã€ã‚’è¦‹ã›ã‚‹ã ã‘ã§ã€é›†ä¸­åŠ›ã¯åŠ‡çš„ã«å¤‰ã‚ã‚Šã¾ã™ã€‚""",
        "low": """ã€ãƒ‘ãƒ‹ãƒƒã‚¯å›é¿ã®å‡¦æ–¹ç®‹ã€‘ ãŠå­ã•ã‚“ã®è„³ã¯ã€å¸¸ã«ã€Œæ¬¡ã«ä½•ãŒèµ·ã“ã‚‹ã‹ã‚ã‹ã‚‰ãªã„ã€ã¨ã„ã†ä¸å®‰ã¨æˆ¦ã£ã¦ã„ã¾ã™ã€‚
                ä»Šã™ããƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰ã‚’ç”¨æ„ã—ã€1é€±é–“ã®äºˆå®šã‚’ã€Œè¦‹ãˆã‚‹åŒ–ã€ã—ã¦ãã ã•ã„ã€‚
                åœ°å›³ã‚’æ‰‹ã«ã—ãŸç¬é–“ã€ãŠå­ã•ã‚“ã®ã‚¤ãƒ©ã‚¤ãƒ©ã¯é©šãã»ã©é™ã¾ã‚Šã¾ã™ã€‚""",
    },
    "A": {
        "high": """ã€è‡ªèµ°ã®ä¼´èµ°è€…ã€‘ ãŠå­ã•ã‚“ã«ã€Œãƒãƒ³ãƒ‰ãƒ«ã€ã‚’æ¡ã‚‰ã›ã‚‹ã“ã¨ãŒã§ãã¦ã„ã¾ã™ã€‚
                è‡ªåˆ†ã§æ±ºã‚ãŸã¨ã„ã†æ„Ÿè¦šï¼ˆAutonomyï¼‰ãŒã€ã‚„ã‚‰ã•ã‚Œã‚‹å‹‰å¼·ã‚’ã€Œè‡ªåˆ†ã®æŒ‘æˆ¦ã€ã«å¤‰ãˆã¦ã„ã¾ã™ã€‚
                ã“ã®è‡ªå¾‹æ€§ã“ããŒã€ä¸­å­¦å…¥å­¦å¾Œã«æœ€ã‚‚ä¼¸ã³ã‚‹å­ã®å…±é€šç‚¹ã§ã™ã€‚""",
        "mid": """ã€è¿·ãˆã‚‹ã‚¬ã‚¤ãƒ‰ã€‘ æ±ºã‚ã‚‹ç·´ç¿’ã‚’ã•ã›ã¦ã‚ã’ãŸã„åé¢ã€ã¤ã„å£ã‚’å‡ºã—ãŸããªã‚‹â€¦â€¦ãã®è‘›è—¤ã€ã‚ˆãã‚ã‹ã‚Šã¾ã™ã€‚
                ã¾ãšã¯ã€Œæ¼¢å­—ã‹ã‚‰ã‚„ã‚‹ï¼Ÿç®—æ•°ã‹ã‚‰ã‚„ã‚‹ï¼Ÿã€ã¨ã„ã£ãŸã€å°ã•ãªæ±ºå®šæ¨©ã‚’1æ—¥3å›ã€
                ãŠå­ã•ã‚“ã«ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã—ã¦ã¿ã¦ãã ã•ã„ã€‚""",
        "low": """ã€æ”¯é…ã‹ã‚‰ã®è„±å´ã€‘ ä»Šã€ãŠå­ã•ã‚“ã¯ã€Œè¦ªã®æ“ã‚Šäººå½¢ã€ã®ã‚ˆã†ã«æ„Ÿã˜ã€è„³ãŒãƒ•ãƒªãƒ¼ã‚ºã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
                ã©ã‚“ãªã«å°ã•ãã¦ã‚‚ã„ã„ã€å ´æ‰€ã‚„æ™‚é–“ã‚’ã€Œè‡ªåˆ†ã§é¸ã‚“ã ã€ã¨ã„ã†çµŒé¨“ã‚’ã•ã›ã¦ãã ã•ã„ã€‚
                è‡ªå·±æ±ºå®šæ¨©ã‚’å–ã‚Šæˆ»ã—ãŸã¨ãã€è„³ã®ã‚¨ãƒ³ã‚¸ãƒ³ãŒå†å§‹å‹•ã—ã¾ã™ã€‚""",
    },
    "R": {
        "high": """ã€æœ€å¼·ã®å®‰å…¨åŸºåœ°ã€‘ å‹‰å¼·ã¨ã„ã†æˆ¦å ´ã‹ã‚‰å¸°ã£ã¦ããŸãŠå­ã•ã‚“ã‚’ã€æ¸©ã‹ãåŒ…ã¿è¾¼ã‚ã¦ã„ã¾ã™ã€‚
                ãŸã‚ã„ã‚‚ãªã„é›‘è«‡ã‚„ç¬‘ã„ãŒã‚ã‚‹å®¶åº­ã¯ã€è„³ã«ã¨ã£ã¦æœ€é«˜ã®ãƒªã‚«ãƒãƒªãƒ¼ãƒ«ãƒ¼ãƒ ã§ã™ã€‚
                ã“ã®å¼·ã„çµ†ãŒã‚ã‚‹ã‹ã‚‰ã“ãã€ãŠå­ã•ã‚“ã¯ä½•åº¦ã§ã‚‚æŒ‘æˆ¦ã§ãã¾ã™ã€‚""",
        "mid": """ã€å°‘ã—ãŠç–²ã‚Œã®æˆ¦å‹ã€‘ ä¼šè©±ã®å†…å®¹ãŒã€Œå‹‰å¼·ãƒ»å¡¾ãƒ»ãƒ†ã‚¹ãƒˆã€ã°ã‹ã‚Šã«ãªã£ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ 
                è„³ã¯ã€è©•ä¾¡ã•ã‚Œãªã„å®‰å…¨ãªç¹‹ãŒã‚Šã‚’æ±‚ã‚ã¦ã„ã¾ã™ã€‚1æ—¥5åˆ†ã ã‘ã§ã„ã„ã®ã§ã€
                å‹‰å¼·ã®è©±é¡Œã‚’ä¸€åˆ‡å°å°ã—ã€ãŠå­ã•ã‚“ã®å¥½ããªã“ã¨ã ã‘ã‚’è´ãæ™‚é–“ã‚’æ­»å®ˆã—ã¦ãã ã•ã„ã€‚""",
        "low": """ã€çµ†ã®å†æ§‹ç¯‰ã€‘ è¦ªå­ã®ç¹‹ãŒã‚ŠãŒã€ä»Šã¯ã€Œæˆç¸¾ã€ã¨ã„ã†æ¡ä»¶ä»˜ãã«ãªã£ã¦ã—ã¾ã£ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
                è„³ã¯å­¤ç‹¬ã‚’æœ€ã‚‚å«Œã„ã¾ã™ã€‚ã¾ãšã¯è¨ˆç®—ãƒŸã‚¹ã‚’å±ã‚‹å‰ã«ã€
                ä»Šæ—¥é ‘å¼µã£ã¦å¡¾ã¸è¡Œã£ãŸã“ã¨ã‚’æŠ±ãã—ã‚ã¦ã‚ã’ã¦ãã ã•ã„ã€‚ç¹‹ãŒã‚ŠãŒæˆ»ã‚Œã°åŠ¹ç‡ã¯å¾Œã‹ã‚‰ã¤ã„ã¦ãã¾ã™ã€‚""",
    },
    "F": {
        "high": """ã€å…¬æ­£ãªå¯©åˆ¤ã€‘ å®¶åº­å†…ã®ãƒ«ãƒ¼ãƒ«ãŒé€æ˜ã§ã€ãŠå­ã•ã‚“ã‚‚æ·±ãç´å¾—ã—ã¦ã„ã¾ã™ã€‚
                åŠªåŠ›ãŒæ­£å½“ã«èªã‚ã‚‰ã‚Œã‚‹ã€Œå…¬å¹³æ€§ï¼ˆFairnessï¼‰ã€ãŒã‚ã‚‹ã‹ã‚‰ã“ãã€ãŠå­ã•ã‚“ã¯çœŸã£ç›´ãã«åŠªåŠ›ã‚’ç¶™ç¶šã§ãã¦ã„ã¾ã™ã€‚
                äººé–“åŒå£«ã®èª å®Ÿãªé–¢ä¿‚ãŒè¦‹äº‹ã§ã™ã€‚""",
        "mid": """ã€èª¿æ•´ä¸­ã®ãƒªãƒ¼ãƒ€ãƒ¼ã€‘ è¦ªã®éƒ½åˆã‚„æ©Ÿå«Œã§ã€ãƒ«ãƒ¼ãƒ«ãŒæºã‚‰ã„ã§ã—ã¾ã†ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ 
                ä¸å…¬å¹³ã¯è„³ã«ç‰©ç†çš„ãªç—›ã¿ã‚’ä¸ãˆã¾ã™ã€‚ä¸€åº¦æ±ºã‚ãŸãƒ«ãƒ¼ãƒ«ã¯ãŠäº’ã„ã«å®ˆã‚‹ã€‚
                ã‚‚ã—å¤‰ãˆã‚‹ãªã‚‰å¯¾è©±ã—ã¦æ±ºã‚ã‚‹ã€‚ãã®èª å®Ÿã•ãŒã€ãŠå­ã•ã‚“ã®ç´å¾—æ„Ÿã‚’ç”Ÿã¿ã¾ã™ã€‚""",
        "low": """ã€ç´å¾—æ„Ÿã®å‡¦æ–¹ç®‹ã€‘ ãŠå­ã•ã‚“ã¯ä»Šã€ã€Œè‡ªåˆ†ã ã‘ãŒæã‚’ã—ã¦ã„ã‚‹ã€ã¨ã„ã†å¼·ã„ä¸æº€ã‚’æŠ±ãˆã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
                ãƒ«ãƒ¼ãƒ«ã‚’ä¸€æ–¹çš„ã«æŠ¼ã—ä»˜ã‘ã‚‹ã®ã‚’ã‚„ã‚ã€è†ã‚’çªãåˆã‚ã›ã¦ã€ŒãŠäº’ã„ã®ç´å¾—ç‚¹ã€ã‚’æ¢ã—ã¦ãã ã•ã„ã€‚
                ç´å¾—æ„Ÿã“ããŒã€è„³ã‚’å‹•ã‹ã™æ½¤æ»‘æ²¹ã§ã™ã€‚""",
    }
}

# =========================
# 4) ãƒ­ã‚¸ãƒƒã‚¯ï¼šã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°
# =========================
def get_level(score):
    if score >= 13: return "high"
    if score >= 8: return "mid"
    return "low"

# =========================
# 5) UIãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
# =========================
def main():
    st.set_page_config(page_title=CONFIG["app_title"], layout="centered")

    st.title(CONFIG["app_title"])
    st.caption(CONFIG["app_subtitle"])

    with st.expander("ã“ã®è¨ºæ–­ã«ã¤ã„ã¦", expanded=True):
        for line in CONFIG["intro_notes"]:
            st.write(line)

    st.divider()

    scores = {"S": 0, "C": 0, "A": 0, "R": 0, "F": 0}
    options = {
        "å…¨ãã‚ã¦ã¯ã¾ã‚‰ãªã„": 1,
        "ã‚ã¾ã‚Šã‚ã¦ã¯ã¾ã‚‰ãªã„": 2,
        "ã©ã¡ã‚‰ã¨ã‚‚ã„ãˆãªã„": 3,
        "ã‚„ã‚„ã‚ã¦ã¯ã¾ã‚‹": 4,
        "éå¸¸ã«ã‚ˆãã‚ã¦ã¯ã¾ã‚‹": 5
    }

    st.subheader("è¨ºæ–­ã‚¹ã‚¿ãƒ¼ãƒˆï¼ˆå…¨15å•ï¼‰")
    
    for i, q in enumerate(QUESTIONS, start=1):
        st.write(f"**Q{i}. {q['title']}**")
        ans = st.select_slider(
            label="é¸æŠã—ã¦ãã ã•ã„",
            options=list(options.keys()),
            value="ã©ã¡ã‚‰ã¨ã‚‚ã„ãˆãªã„",
            key=f"q_{i}",
            label_visibility="collapsed"
        )
        scores[q["cat"]] += options[ans]
        st.write("")

    st.divider()

    if st.button("è¨ºæ–­çµæœã‚’è¡¨ç¤ºã™ã‚‹"):
        st.balloons()

        st.divider()
        st.info("ğŸ’¡ å…¨ä½“ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸")
        st.markdown("""
        ### è¨ºæ–­ã‚’çµ‚ãˆãŸã‚ãªãŸã¸ã€‚
        
        ã¾ãšã¯ã€ã‚ãŒå­ã®ãŸã‚ã«ä»Šæ—¥ã“ã®3åˆ†é–“ã‚’ä½¿ã„ã€ç¾çŠ¶ã¨å‘ãåˆã£ãŸã”è‡ªèº«ã‚’
        å¿ƒã‹ã‚‰ç§°ãˆã¦ãã ã•ã„ã€‚ä¸­å­¦å—é¨“ã¨ã„ã†è’æ³¢ã®ä¸­ã§ã€è¦ªãŒã§ãã‚‹æœ€é«˜ã®æŠ•è³‡ã¯
        ã€Œå¡¾ã‚’å¢—ã‚„ã™ã“ã¨ã€ã§ã¯ãªãã€ã€ŒãŠå­ã•ã‚“ã®è„³ãŒå®‰å¿ƒã—ã¦åƒã‘ã‚‹ç’°å¢ƒã‚’æ•´ãˆã‚‹ã“ã¨ã€ã§ã™ã€‚
        
        ä»Šæ—¥ã®ã‚¹ã‚³ã‚¢ãŒã©ã†ã§ã‚ã‚Œã€ãã‚Œã¯å˜ãªã‚‹ã€Œç¾åœ¨ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã€ã«éãã¾ã›ã‚“ã€‚
        SCARFãƒ¢ãƒ‡ãƒ«ã®ç´ æ™´ã‚‰ã—ã„ç‚¹ã¯ã€**é–¢ã‚ã‚Šæ–¹ä¸€ã¤ã§ã€ä»Šæ—¥ã“ã®ç¬é–“ã‹ã‚‰
        è„³ã®å ±é…¬ç³»ã‚’èµ·å‹•ã§ãã‚‹**ã“ã¨ã§ã™ã€‚
        
        ã“ã“ã«ä¸¦ã‚“ã ã€Œé­‚ã®å‡¦æ–¹ç®‹ã€ãŒã€æ˜æ—¥ã‹ã‚‰ã®ãƒªãƒ“ãƒ³ã‚°ã®æ™¯è‰²ã‚’
        å°‘ã—ã§ã‚‚æ˜ã‚‹ãç…§ã‚‰ã™ã“ã¨ã‚’é¡˜ã£ã¦ã„ã¾ã™ã€‚
        
        ã‚ãªãŸã¯ä¸€äººã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
        ç§ã‚‚ã“ã®ç†è«–ã¨å…±ã«ã€æœ€å¾Œã¾ã§ã‚ãªãŸã®ä¼´èµ°ã‚’ç¶šã‘ã¾ã™ã€‚
        """)
        
        df_scores = pd.DataFrame({
            "è¦ç´ ": [CATEGORIES[k] for k in scores.keys()],
            "ã‚¹ã‚³ã‚¢": list(scores.values())
        })
        
        st.subheader("ğŸ“Š ã‚ãŒå®¶ã®è„³å†…ç’°å¢ƒã‚¹ã‚³ã‚¢")
        fig = px.line_polar(
            df_scores, r='ã‚¹ã‚³ã‚¢', theta='è¦ç´ ', 
            line_close=True, range_r=[0,15]
        )
        fig.update_traces(fill='toself')
        st.plotly_chart(fig)

        st.subheader("ğŸ’¡ è„³ç§‘å­¦ã‚¢ãƒ‰ãƒã‚¤ã‚¹")
        
        # ã‚¹ã‚³ã‚¢ã®ä½ã„é †ã«ä¸¦ã¹æ›¿ãˆ
        sorted_scores = sorted(scores.items(), key=lambda x: x[1])

        # å„ã‚«ãƒ†ã‚´ãƒªã«å¯¾å¿œã™ã‚‹noteè¨˜äº‹ã®URLï¼ˆå®Ÿéš›ã®URLã«æ›¸ãæ›ãˆã¦ãã ã•ã„ï¼‰
        NOTE_URLS = {
            "S": "https://note.com/like_sorrel1679/n/n5d8b498a175e",
            "C": "https://note.com/like_sorrel1679/n/n31e293d19d5a",
            "A": "https://note.com/like_sorrel1679/n/nd8b533de3f6b",
            "R": "https://note.com/like_sorrel1679/n/n0bc65fed1d89",
            "F": "https://note.com/like_sorrel1679/n/n9ade3742e407"
        }
        for cat_key, score in sorted_scores:
            level = get_level(score)
            is_expanded = (cat_key == sorted_scores[0][0])
            
            with st.expander(f"{CATEGORIES[cat_key]} ï¼š {score}ç‚¹", expanded=is_expanded):
                st.write(FEEDBACK[cat_key][level])
                
                # ã“ã“ã§ã‚«ãƒ†ã‚´ãƒªã«å¿œã˜ãŸURLã‚’å‹•çš„ã«å–å¾—ã—ã¾ã™
                target_url = NOTE_URLS.get(cat_key, "https://note.com/")
                st.markdown(f"ğŸ”— [ã“ã®è¦ç´ ï¼ˆ{cat_key}ï¼‰ã®è§£èª¬è¨˜äº‹ã‚’èª­ã¿ç›´ã™]({target_url})")

        # ä¿®æ­£å¾Œï¼š196è¡Œç›®ä»˜è¿‘
        st.divider()
        st.subheader("2æœˆ17æ—¥ï¼ˆç«ï¼‰ 21:00 å…¬é–‹äºˆå®š")
        st.write("ã“ã®è¨ºæ–­çµæœã‚’èƒ¸ã«ã€æœˆæ›œæ—¥ã‚’ç¬‘é¡”ã§è¿ãˆã‚‹æº–å‚™ã‚’ã—ã¾ã—ã‚‡ã†ã€‚")
        st.caption(CONFIG["footer"])

if __name__ == "__main__":
    main()
